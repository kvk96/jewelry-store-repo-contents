<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Jewelry Store — Starter</title>
  <style>
    :root{--accent:#b58360;--muted:#666}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:#fff;color:#111}
    header{background:linear-gradient(90deg,#fff,#fff);padding:28px 24px;border-bottom:1px solid #eee}
    .container{max-width:1100px;margin:24px auto;padding:0 16px}
    h1{margin:0;font-size:28px}
    p.lead{color:var(--muted);margin:6px 0 18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px}
    .card{border:1px solid #eee;border-radius:12px;padding:12px;overflow:hidden;box-shadow:0 4px 14px rgba(10,10,10,0.04)}
    .media{height:220px;background:#f7f7f7;border-radius:8px;background-size:cover;background-position:center}
    .meta{padding-top:10px}
    .title{font-weight:600;margin:0 0 6px}
    .price{color:var(--accent);font-weight:700}
    .desc{color:var(--muted);font-size:13px;margin:8px 0}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:var(--accent);color:#fff;text-decoration:none;font-weight:600}
    .small{font-size:13px;color:#666}
    footer{padding:18px;text-align:center;color:#666;border-top:1px solid #f0f0f0;margin-top:28px}
    .admin{background:#fffbe6;border:1px solid #ffecb3;padding:12px;border-radius:8px;margin:18px 0}
    @media (max-width:640px){.media{height:180px}}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>My Jewelry Store</h1>
      <p class="lead">Beautiful necklaces, rings and bracelets — pay securely using payment links. No backend required.</p>
    </div>
  </header>

  <main class="container">

    <section id="products">
      <div class="grid" id="product-grid"></div>
    </section>

    <section class="admin" id="admin">
      <strong>Admin / Setup</strong>
      <p class="small">This site uses <em>payment links</em>. To make it live for purchases:
      <ol>
        <li>Create a merchant account in your preferred gateway (Razorpay / Cashfree / PayU).</li>
        <li>From the gateway dashboard, create Payment Links for each product (set amount, product name, taxes/shipping if any).</li>
        <li>Replace the <code>payment_link</code> value for each product in the Google Sheet (the generator updates products.json automatically).</li>
        <li>Deploy to GitHub Pages (Settings → Pages) or Netlify. For GitHub Pages, enable it on the main branch root.</li>
      </ol>
      </p>

      <p class="small"><strong>Manual order flow:</strong> after a sale you'll get a payment confirmation email from the gateway. Use that to update your Google Sheet order log and message the buyer over WhatsApp with dispatch details.</p>
    </section>

    <section>
      <h2>How to Customize Quickly</h2>
      <ul>
        <li>Edit product rows in the Google Sheet; the GitHub Action will publish changes to <code>products.json</code> hourly (or on push).</li>
        <li>Host product images on Imgur / Cloudinary / raw.githubusercontent.com and paste the direct image links into the sheet.</li>
        <li>If you later want a cart flow, we can add a client-side cart and consolidated checkout page that sends you the order for manual invoicing.</li>
      </ul>
    </section>

  </main>

  <footer>
    <div class="container">
      <div class="small">Starter static site • Uses products.json generated by GitHub Actions from your Google Sheet CSV.</div>
    </div>
  </footer>

  <script>
  // Fetch products.json from repo root (generated by GitHub Action)
  async function loadProductsFromJson() {
    try {
      const res = await fetch('/products.json', {cache: 'no-store'});
      if (!res.ok) throw new Error('Failed to fetch /products.json: ' + res.status);
      const products = await res.json();
      renderProducts(products);
    } catch (err) {
      console.error(err);
      document.getElementById('product-grid').innerHTML = '<div class="small">Failed to load products. Check products.json.</div>';
    }
  }

  function escapeHtml(text) {
    const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
    return String(text).replace(/[&<>\"']/g, function(m) { return map[m]; });
  }

  function createCard(p){
    const price = p.price_display || (p.amount ? '₹' + Number(p.amount).toLocaleString('en-IN') : '');
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `
      <div class="media" style="background-image:url('${p.image || ''}')"></div>
      <div class="meta">
        <div class="title">${escapeHtml(p.title || '')}</div>
        <div class="price">${escapeHtml(price)}</div>
        <div class="desc">${escapeHtml(p.desc || '')}</div>
        <div style="margin-top:8px">
          <a class="btn" href="${p.payment_link || '#'}" target="_blank" rel="noopener noreferrer">${p.payment_link ? 'Buy — Pay' : 'Contact to Buy'}</a>
          <a class="small" style="margin-left:10px" href="mailto:info@yourstore.com?subject=Query about ${encodeURIComponent(p.title || '')}">Enquiry</a>
        </div>
      </div>
    `;
    return el;
  }

  function renderProducts(products){
    const grid = document.getElementById('product-grid');
    grid.innerHTML = '';
    if (!products || products.length === 0) {
      grid.innerHTML = '<div class="small">No products available yet. Populate the Products sheet and wait for the action to run.</div>';
      return;
    }
    products.forEach(p => grid.appendChild(createCard(p)));
  }

  loadProductsFromJson();
  setInterval(loadProductsFromJson, 5 * 60 * 1000);
  </script>
</body>
</html>